<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Patient Details</title>
  <link rel="stylesheet" href="./assets/css/datatables.css" />
  <link rel="stylesheet" href="./assets/css/bootstrap.css" />
  <script src="env.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script>
    urlString = window.location.href;
    let paramString = urlString.split('?')[1];
    let queryString = new URLSearchParams(paramString);
    for (let pair of queryString.entries()) {
      id = pair[1];
      // console.log("Key is:" + pair[0]);
      // console.log("Value is:" + pair[1]);
    }
    var token = localStorage.getItem('token');
    var user_ida = localStorage.getItem('id');



    function sharedataemail1() {
      document.getElementById("loader1").style.visibility = "visible";
      var email = document.getElementById("sharedataemail").value;
      patient_link = `${clientbaseurl}/patientdetails.html?id=${id}`;
      // console.log(patient_link)
      $.ajax({
        type: "post",
        url: `${baseurl}/share-email-data`,
        data: {
          email: email,
          patient_link: patient_link
        },
        timeout: 0,
        // headers: {
        //   "Authorization": `Bearer ${token}`,
        //   "Content-Type": "application/json",
        // },
        success: function (response) {
          // $("#div11").html(result);
          // console.log(response);
          Swal.fire({
            icon: 'success',
            title: 'Successful!',
            text: response.msg,
            allowOutsideClick: false
          })
          $('button.swal2-confirm').click(function () {
            location.replace(`./patientdetails.html?id=${id}`);
          });

          document.getElementById("loader1").style.visibility = "hidden";
        },
        error: function (response) {
          // console.log(response);

          // if(response.responseJSON.message == "Authentication failed"){
          //   window.location.replace("index.html");
          //     }
        }
      });
    }
  </script>
</head>

<body>
  <aside>
    <div class="top">
      <a href="./index.html" class="d-block">
        <img src="./assets/images/logo-white.svg" height="48px" class="logo" alt="">
      </a>
      <ul class="list-unstyled ps-0 mb-0">
        <li class="side-link ">
          <a href="./dashboard.html">
            <span class="material-symbols material-symbols-rounded">team_dashboard</span>
            Dashboard
          </a>
        </li>
        <li class="side-link active">
          <a href="./registeredpatients.html">
            <span class="material-symbols material-symbols-rounded">person</span>
            Patients
          </a>
        </li>
        <li class="side-link">
          <a href="#" id="messagesanchor">
            <span class="material-symbols material-symbols-rounded">mail</span>
            Messages
            <!-- <div class="badge">New</div> -->
          </a>
        </li>
        <li class="side-link">
          <a href="./profile.html">
            <span class="material-symbols material-symbols-rounded">settings</span>
            Settings
          </a>
        </li>
        <li class="side-link">
          <a href="./activate.html">
            <span class="material-symbols material-symbols-rounded"
              >shop</span
            >
            Activate Device
          </a>
        </li>
        <li class="side-link">
          <a href="./orderdevice.html">
            <span class="material-symbols material-symbols-rounded"
              >shop</span
            >
            Order Device
          </a>
        </li>

      </ul>
    </div>
    <div class="bottom">
      <div class="side-link">
        <a href="" id="logout-btn">
          <span class="material-symbols material-symbols-rounded">logout</span>
          Logout
        </a>
      </div>
    </div>
  </aside>
  <main>
    <header>
      <div class="container">
        <div class="search-container">
          <a href="" class="logo">Udatum</a>
          <button type="button" class="search" id="search">
            <span class="material-symbols material-symbols-rounded">search</span>
          </button>

        </div>
        <div class="right">
          <div class="dropdown">
            <button type="button" class="notifications unread" type="button" id="dropdownMenuButton1"
              data-bs-toggle="dropdown" aria-expanded="false">
              <span class="material-symbols material-symbols-rounded">notifications</span>
            </button>
            <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
              <li><a class="dropdown-item" href="#">Action</a></li>
              <li><a class="dropdown-item" href="#">Another action</a></li>
              <li>
                <a class="dropdown-item" href="#">Something else here</a>
              </li>
            </ul>
          </div>

          <button type="button" class="avatar unread" id="user-initials"></button>
          <button type="button" class="menu" id="menu">
            <span class="material-symbols material-symbols-rounded">menu</span>
          </button>
        </div>
      </div>
    </header>
    <div class="container">
      <div class="top-bar">
        <div class="date-time" id="clock">
          <span class="me-4"></span>
          <span></span>
        </div>
      </div>
    </div>
    <div class="content">
      <div class="patient-details-box bg-white mb-xl-5 mb-3">
        <div class="d-flex align-items-center justify-content-between flex-wrap">
          <div class="left">
            <h5 class="fw-bold me-xl-5 me-4"><span id="namea"></span> Data Record</h5>
            <div class="d-inline-block">
              <h6 class="signup-hd">Sign Up Date</h6>
              <p class="signup-date" id="signup-date"></p>
            </div>
          </div>
          <div class="right">
            <button class="btn btn-primary py-lg-2" data-bs-toggle="modal" data-bs-target="#addNote">
              <span class="material-symbols material-symbols-rounded">add</span>
              Add New Note
            </button>
            <button class="btn btn-outline-primary py-lg-2" data-bs-toggle="modal" data-bs-target="#shareData">
              <span class="material-symbols material-symbols-rounded">share</span>
              Share Data
            </button>
          </div>
        </div>
        <div class="row">
          <div class="col-xl-5 col-12">
            <table class="table table-borderless mb-0">
              <tbody>
                <tr>
                  <th scope="col">Patient Email</th>
                  <td id="pemail"></td>
                </tr>
                <tr>
                  <th scope="col">Birth Date</th>
                  <td id="dob"></td>
                </tr>
                <tr class="time-spend">
                  <th scope="col">Time Spent On Patient in Dec</th>
                  <td>
                    <div id="timeonpatient" class="badge time-spent"></div>
                    <div id="timeonpatient1" class="d-inline-block ms-1"><button
                        class="py-0 btn btn-sm btn-outline-primary" type="button" onclick="savetime()">Save</button>
                    </div>
                  </td>
                </tr>
                <tr class="time-spend">
                  <th scope="col">Medical Condition</th>
                  <td id="medical_condition"></td>
                </tr>
                <tr class="time-spend">
                  <th scope="col">Notes</th>
                  <td>
                    <!-- <script>console.log(id)</script> -->
                    <a type="button" onclick="myfunc(this)" class="fw-normal">View All Notes</a>
                  </td>

                </tr>
              </tbody>
            </table>
          </div>
        </div>
        <hr />
        <div class="d-flex align-items-center justify-content-between">
          <h5 class="fw-bold mb-4">Linked Devices</h5>
        </div>
        <div class="col">
          <table class="linked-dev">
            <thead>
              <tr>
                <th scope="col">Device Name</th>
                <th scope="col">Device ID</th>
              </tr>
            </thead>
            <tbody id="devices_list">

            </tbody>
          </table>
        </div>
      </div>
      <!-- <div class="patient-details-box bg-white mb-xl-5 mb-3">
          <div class="linked-devices">
            <div class="devices">
              <div class="device">
                <img
                  src="./assets/images/stethoscope.png"
                  class="device-img"
                  alt=""
                />
                <h6 class="device-name">Classic Stethoscope</h6>
              </div>
              <div class="device">
                <img
                  src="./assets/images/smartwatch.png"
                  class="device-img"
                  alt=""
                />
                <h6 class="device-name">Samsung Smartwatch</h6>
              </div>
              <div class="device">
                <img
                  src="./assets/images/bp-meter.png"
                  class="device-img"
                  alt=""
                />
                <h6 class="device-name">BP Meter</h6>
              </div>
              <div class="device">
                <img
                  src="./assets/images/bp-meter.png"
                  class="device-img"
                  alt=""
                />
                <h6 class="device-name">BP Meter</h6>
              </div>
              <div class="device">
                <img
                  src="./assets/images/bp-meter.png"
                  class="device-img"
                  alt=""
                />
                <h6 class="device-name">BP Meter</h6>
              </div>
            </div>
            <button class="move forward">
              <span class="material-symbols material-symbols-rounded"
                >arrow_forward_ios</span
              >
            </button>
          </div>
        </div> -->


      <div class="patient-details-box bg-white mb-xl-5" id="analytics_area">
        <div>
          <ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
            <!-- <li class="nav-item" role="presentation">
              <button class="nav-link" id="weight-scale-tab" data-bs-toggle="pill" data-bs-target="#weight-scale"
                type="button" role="tab" aria-controls="weight-scale" aria-selected="false">
                Weight Scale
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" id="pulse-tab" data-bs-toggle="pill" data-bs-target="#pulse" type="button"
                role="tab" aria-controls="pulse" aria-selected="false">
                Pulse Oximeter
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link active" id="heart-rate-tab" data-bs-toggle="pill" data-bs-target="#heart-rate"
                type="button" role="tab" aria-controls="heart-rate" aria-selected="false">
                Heart Rate
              </button>
            </li> -->
            <li class="nav-item" role="presentation">
              <button class="nav-link" id="blood-pressure-tab" data-bs-toggle="pill" data-bs-target="#blood-pressure"
                type="button" role="tab" aria-controls="blood-pressure" aria-selected="false">
                Blood Pressure
              </button>
            </li>
            <!-- <li class="nav-item" role="presentation">
              <button class="nav-link" id="steps-tab" data-bs-toggle="pill" data-bs-target="#steps" type="button"
                role="tab" aria-controls="steps" aria-selected="false">
                Step Tracker
              </button>
            </li> -->
          </ul>
          
          <!-- <div class="tab-pane fade" id="weight-scale" role="tabpanel" aria-labelledby="weight-scale-tab">
              <div class="patient-details-box bg-white mb-xl-5 mt-4">
                <div class="d-flex align-items-center flex-md-nowrap flex-wrap justify-content-between">
                  <div class="d-flex align-items-center gap-3 mb-3">
                    <div class="vector-icon green">
                    </div>
                    <h5 class="fw-bold">Weight Scale</h5>
                  </div>
                  
                </div>

                <div class="d-block w-100 mt-xl-5 mt-3">
                  <div style="height: 300px">
                    <canvas id="myChart3"></canvas>
                  </div>
                  <div class="text-center mt-4">
                    <button class="btn btn-primary px-xl-4">
                      <span class="material-symbols material-symbols-rounded">print</span>
                      Print
                    </button>
                  </div>
                </div>
              </div>
          </div> -->
          <!-- <div class="tab-pane fade" id="pulse" role="tabpanel" aria-labelledby="pulse-tab"></div> -->
          <!-- <div class="tab-pane fade" id="heart-rate" role="tabpanel" aria-labelledby="heart-rate-tab">
            <div class="d-flex align-items-center flex-md-nowrap flex-wrap justify-content-between">
              <div class="d-flex align-items-center gap-3 mb-3">
                <div class="vector-icon blue">
                  <span class="material-symbols material-symbols-rounded top-0">vital_signs</span>
                </div>
                <h5 class="fw-bold">Heart Rate</h5>
              </div>
              <div class="d-flex align-items-center flex-md-nowrap flex-wrap gap-3 mb-3">

                <button class="btn btn-primary px-xl-4 mb-2">
                  <span class="material-symbols material-symbols-rounded">print</span>
                  Print
                </button>
              </div>
            </div>

            <div class="d-block w-100 mt-xl-5 mt-3" style="height: 300px">
              <canvas id="myChart"></canvas>
            </div>
          </div> -->
          <div class="tab-pane fade" id="blood-pressure" role="tabpanel" aria-labelledby="blood-pressure-tab">
            <div class="patient-details-box bg-white mb-xl-5 mt-4">
              <div class="d-flex align-items-center flex-md-nowrap flex-wrap justify-content-between">
                <div class="d-flex align-items-center gap-3 mb-3">
                  <div class="vector-icon green">
                    <span class="material-symbols material-symbols-rounded top-0">blood_pressure</span>
                  </div>
                  <h5 class="fw-bold">Blood Pressure Tracker</h5>
                </div>
              </div>

              <div class="d-block w-100 mt-xl-5 mt-3">
                <div style="height: 300px">
                  <canvas id="myChart2"></canvas>
                </div>
                <div class="text-center mt-4">
                  <button class="btn btn-primary px-xl-4">
                    <span class="material-symbols material-symbols-rounded">print</span>
                    Print
                  </button>
                </div>
              </div>
            </div>
          </div>
          <!-- <div class="tab-pane fade" id="steps" role="tabpanel" aria-labelledby="steps-tab">
            <div class="patient-details-box bg-white mb-xl-5 mt-4">
              <div class="d-flex align-items-center flex-md-nowrap flex-wrap justify-content-between">
                <div class="d-flex align-items-center gap-3 mb-3">
                  <div class="vector-icon green">
                    <span class="material-symbols material-symbols-rounded top-0">footprint</span>
                  </div>
                  <h5 class="fw-bold">Step Tracker</h5>
                </div>
              </div>

              <div class="d-block w-100 mt-xl-5 mt-3">
                <div style="height: 300px">
                  <canvas id="myChart2"></canvas>
                </div>
                <div class="text-center mt-4">
                  <button class="btn btn-primary px-xl-4">
                    <span class="material-symbols material-symbols-rounded">print</span>
                    Print
                  </button>
                </div>
              </div>
            </div>
          </div>  -->
        </div>
      </div>
    </div>
  </main>
  <!-- <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Enter Details</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label">Client ID</label>
            <input type="text" class="form-control" id="clientid">
          </div>
          <div class="mb-3">
            <label class="form-label">Client Secret</label>
            <input type="text" class="form-control" id="clientsecret">
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary" onclick="safe_basic_dta()">Save changes</button>
        </div>
      </div>
    </div>
  </div> -->
  <!-- Modal -->
  <div class="modal fade" id="addNote" tabindex="-1" aria-labelledby="addNoteLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header border-0">
          <h5 class="modal-title" id="addNoteLabel"></h5>
        </div>
        <div class="modal-body">
          <div class="text-center">
            <h5 class="fw-bold mb-4">ADD A NEW NOTE TO THIS PATIENT</h5>
            <table class="table table-borderless">
              <tbody>
                <tr>
                  <th>Note</th>
                  <td>
                    <input type="text" name="note" id="note" class="form-control" />
                  </td>
                </tr>
              </tbody>
            </table>
            <a type="button" onclick="addnote1()" class="btn btn-primary btn-lg px-xl-4 mx-3">
              <span class="material-symbols material-symbols-rounded">add</span>
              Add Note
            </a>
            <button class="btn btn-outline-primary btn-lg px-xl-4 mx-3" data-bs-dismiss="modal">
              Cancel
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal -->
  <div class="modal fade" id="shareData" tabindex="-1" aria-labelledby="shareDataLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header border-0">
          <h5 class="modal-title" id="shareDataLabel"></h5>
        </div>
        <div class="modal-body">
          <div class="text-center">
            <h5 class="fw-bold mb-4">SHARE DATA WITH OTHER PHYSICIANS</h5>
            <form>
              <table class="table table-borderless">
                <tbody>
                  <tr>
                    <th>Email</th>
                    <td>
                      <input required id="sharedataemail" type="email" class="form-control" />
                    </td>
                  </tr>
                </tbody>
              </table>

              <a type="button" onclick="sharedataemail1()" class="btn btn-primary btn-lg px-xl-4 mx-3">
                <span class="material-symbols material-symbols-rounded">check</span>
                Share
              </a>

              <button class="btn btn-outline-primary btn-lg px-xl-4 mx-3" data-bs-dismiss="modal">
                Cancel
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="loading" id="loader1" style="visibility: hidden;">Loading&#8230;</div>
  <script src="./assets/js/all.js"></script>
  <script src="./assets/js/script.js"></script>
  <script src="./assets/js/datatables.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    $(document).ready(function () {
      var messagesanchor = document.getElementById("messagesanchor");
      messagesanchor.setAttribute("href", `${clientbaseurl}/doctor/chat.html?id=${user_ida}`);
      // Attach click event handler to logout button
      $('#logout-btn').click(function (event) {
        event.preventDefault();
        // Display confirmation dialog using SweetAlert2
        Swal.fire({
          title: 'Are you sure you want to logout?',
          icon: 'warning',
          showCancelButton: true,
          confirmButtonColor: '#3085d6',
          cancelButtonColor: '#d33',
          confirmButtonText: 'Yes, logout'
        }).then((result) => {
          if (result.isConfirmed) {
            // If user confirms logout, get authentication token from local storage
            var token = localStorage.getItem('token');

            // Send POST request to logout API endpoint
            $.ajax({
              url: `${baseurl}/doctor-logout`,
              type: 'GET',
              headers: {
                'Authorization': 'Bearer ' + token
              },
              success: function (response) {
                // If logout successful, remove token from local storage and redirect to login page
                localStorage.removeItem('token');
                localStorage.removeItem('id');
                window.location.href = './index.html';
              },
              error: function (xhr, status, error) {
                // If error occurred, display error message using SweetAlert2
                Swal.fire({
                  title: 'Error',
                  text: 'Logout failed: ' + error,
                  icon: 'error',
                  confirmButtonColor: '#3085d6',
                  confirmButtonText: 'OK'
                });
              }
            });
          }
        });
      });

      function toHoursAndMinutes(totalSeconds) {
        const totalMinutes = Math.floor(totalSeconds / 60);

        const seconds = totalSeconds % 60;
        const hours = Math.floor(totalMinutes / 60);
        const minutes = totalMinutes % 60;

        return {
          h: hours,
          m: minutes,
          s: seconds
        };
      }
      // Update clock display every second
      setInterval(function () {
        var now = new Date();

        // Format date and time
        var date = now.toLocaleDateString('en-US', {
          day: 'numeric',
          month: 'long',
          year: 'numeric'
        });
        var hours = now.getHours();
        var minutes = now.getMinutes();
        var seconds = now.getSeconds();
        var ampm = hours >= 12 ? 'PM' : 'AM';
        hours = hours % 12;
        hours = hours ? hours : 12;
        minutes = minutes < 10 ? '0' + minutes : minutes;
        seconds = seconds < 10 ? '0' + seconds : seconds;
        var time = hours + ':' + minutes + ':' + seconds + ' ' + ampm;

        // Display date and time in clock element
        $('#clock').text(date + ' ' + time);
      }, 1000);

      // Check if user is logged in and display name initials


      //get time of a paitent
      document.getElementById("loader1").style.visibility = "visible";
      data = JSON.stringify({
        did: user_ida,
      });
      $.ajax({
        type: "post",
        url: `${baseurl}/get-one-patient-time/${id}`,
        timeout: 0,
        data: data,
        headers: {
          "Authorization": `Bearer ${token}`,
          "Content-Type": "application/json",
        },
        success: function (response) {
          console.log(response);
          timeonscreen = parseInt(response.results[0].time_spent);
          document.getElementById("loader1").style.visibility = "hidden";
        }
      });

      function starttimer(timeonscreen) {
        timeonscreen = timeonscreen + 1;
        var timeonscreen1 = toHoursAndMinutes(timeonscreen);
        var hours = timeonscreen1.h;
        var mins = timeonscreen1.m;
        var secs = timeonscreen1.s;
        timeonscreen2 = hours + ":" + mins + ":" + secs;
        document.getElementById("timeonpatient").innerHTML = timeonscreen2;
        return timeonscreen;
      }
      // }

      //Timer on the screen

      var cond = 1;
      setInterval(function () {
        if (cond == 1) {
          timeonscreen = starttimer(timeonscreen);
        }

      }, 1000);
      window.addEventListener("visibilitychange", (event) => {
        if (document.visibilityState === "hidden") {
          cond = 0;
        } else {
          cond = 1;
        }
      });

      // const beforeUnloadListener = (event) => {
      //   event.preventDefault();
      //   return event.returnValue = '';
      // };
      // document.addEventListener("beforeunload", (event) => {
      //   alert(timeonscreen)
      // });
      window.onbeforeunload = function (e) {
        e = e || window.event;

        // For IE and Firefox prior to version 4
        if (e) {
          e.returnValue = 'Sure?';
        }

        // For Safari
        return 'Sure?';
      };



      // Extract the user's name from the token
      var name = JSON.parse(atob(token.split('.')[1])).name;

      // Display the first two letters of the name in the designated element
      var initials = name.substr(0, 2).toUpperCase();
      $('#user-initials').text(initials);

      function getMonthName(monthNumber) {
        const date = new Date();
        date.setMonth(monthNumber - 1);
        return date.toLocaleString('en-US', {
          month: 'long'
        });
      }
      // console.log(token)
      if (token == null) {
        window.location.replace("index.html");
      } else {
        $.ajax({
          type: "get",
          url: `${baseurl}/patient-list-of-a-doctor`,
          timeout: 0,
          headers: {
            "Authorization": `Bearer ${token}`,
            "Content-Type": "application/json",
          },
          success: function (response) {
            // $("#div11").html(result);
            // console.log("success");
            // document.getElementById("loader1").style.visibility = "hidden";
          },
          error: function (response) {
            // console.log(response);

            if (response.responseJSON.message == "Authentication failed") {
              window.location.replace("index.html");
            }
          }
        });
      }
      // var did = localStorage.getItem('id');
      // $.ajax({
      //     type: "get",
      //     url: `${baseurl}/get-cid-csecret/${did}`,
      //     timeout: 0,
      //     headers: {
      //       "Authorization": `Bearer ${token}`,
      //       "Content-Type": "application/json",
      //     },
      //     success: function (response) {
      //       // $("#div11").html(result);
      //       // console.log(response);
      //       if(response.msg.length == 0){
      //         document.getElementById("button_attach_account").classList.remove("d-none");
      //       }
      //       else if(response.msg == "Not Found"){
      //         document.getElementById("button_attach_account").classList.remove("d-none");
      //       }
      //       else{
      //         document.getElementById("analytics_area").classList.remove("d-none");
      //       }
      //       // document.getElementById("loader1").style.visibility = "hidden";
      //     },
      //     error: function (response) {
      //       // console.log(response);

      //       // if (response.responseJSON.message == "Authentication failed") {
      //       //   window.location.replace("index.html");
      //       // }
      //     }
      //   });
        $.ajax({
        type: "get",
        url: `${baseurl}/get-withings-url`,
        timeout: 0,
        headers: {
          "Authorization": `Bearer ${token}`,
          "Content-Type": "application/json",
        },
        success: function (response) {
          // console.log(response.url)
          // window.location.replace(response.url);
          // console.log(response.nonce)
          // Swal.fire({
          //   icon: 'success',
          //   title: 'Successful!',
          //   text: response.message,
          //   allowOutsideClick: false
          // })
          // $('button.swal2-confirm').click(function () {
          //   location.replace(`./patientdetails.html?id=${id}`);
          // });
          // timeonscreen = parseInt(response.results[0].time_spent);
          document.getElementById("loader1").style.visibility = "hidden";
        }
      });
      // const id = urlParams.get('id');
      document.getElementById("loader1").style.visibility = "visible";
      $.ajax({
        type: "get",
        url: `${baseurl}/get-one-patient/${id}`,
        timeout: 0,
        headers: {
          "Authorization": `Bearer ${token}`,
          "Content-Type": "application/json",
        },
        success: function (response) {

          // $("#div11").html(result);
          // console.log
          var dateFormat = new Date(response.created_at);
          var dateFormat1 = new Date(response.date_of_birth);

          document.getElementById("namea").innerText = response.name;
          document.getElementById("signup-date").innerText = dateFormat.getDate() + "/" + (dateFormat
            .getMonth() + 1) + "/" + dateFormat.getFullYear();
          document.getElementById("pemail").innerText = response.email;
          document.getElementById("dob").innerText = dateFormat1.getDate() - 1 + "/" + getMonthName((
            dateFormat1.getMonth() + 1)) + "/" + dateFormat1.getFullYear();
          document.getElementById("medical_condition").innerText = response.medical_condition;
          $.ajax({
            type: "get",
            url: `${baseurl}/get-one-patient-devices/${id}`,
            timeout: 0,
            headers: {
              "Authorization": `Bearer ${token}`,
              "Content-Type": "application/json",
            },
            success: function (response1) {

              // $("#div11").html(result);
              // console.log
              response1.forEach(key => {
                document.getElementById("devices_list").innerHTML +=
                  `<tr>
                                <td>${key.device_name}</td>
                                <td>${key.device_barcode}</td>
                              </tr>`;
              });

              // pemail
              // console.log(response1);

              // document.getElementById("loader1").style.visibility = "hidden";
            }
          });
          // pemail
          // console.log(response);

          document.getElementById("loader1").style.visibility = "hidden";
        }
      });



      if ($(window).width() < 768) {
        $("#search").click(function () {
          $(this).next().slideToggle();
        });
      }

      if ($(window).width() < 1100) {
        $("#menu").click(function () {
          $("aside").toggleClass("d-flex");
        });
      }
    });

    function toSeconds(timeStr) {
      const [hours, minutes, seconds] = timeStr.split(':').map(Number);
      return hours * 3600 + minutes * 60 + seconds;
    }
    //update patient time
    function savetime() {
      var current = document.getElementById("timeonpatient").innerText;
      var current = toSeconds(current);
      document.getElementById("loader1").style.visibility = "visible";
      data = JSON.stringify({
        pid: id,
        did: user_ida,
        time: current
      });
      $.ajax({
        type: "post",
        url: `${baseurl}/update-one-patient-time`,
        timeout: 0,
        data: data,
        headers: {
          "Authorization": `Bearer ${token}`,
          "Content-Type": "application/json",
        },
        success: function (response) {
          console.log(response)
          Swal.fire({
            icon: 'success',
            title: 'Successful!',
            text: response.message,
            allowOutsideClick: false
          })
          $('button.swal2-confirm').click(function () {
            location.replace(`./patientdetails.html?id=${id}`);
          });
          // timeonscreen = parseInt(response.results[0].time_spent);
          document.getElementById("loader1").style.visibility = "hidden";
        }
      });
      // console.log(current);
    }

    function addnote1() {
      document.getElementById("loader1").style.visibility = "visible";
      // var token = localStorage.getItem('token');
      var note = document.getElementById("note").value;
      var data = JSON.stringify({
        patient_id: id,
        note: note
      })

      $.ajax({
        type: "post",
        url: `${baseurl}/add-note/`,
        data: data,
        timeout: 0,
        headers: {
          "Authorization": `Bearer ${token}`,
          "Content-Type": "application/json",
        },
        success: function (response1) {

          // $("#div11").html(result);
          // console.log(response1);
          if (response1.success) {
            document.getElementById("loader1").style.visibility = "hidden";
            Swal.fire({
              icon: 'success',
              title: 'Successful!',
              text: response1.message,
              allowOutsideClick: false
            })
            $('button.swal2-confirm').click(function () {
              location.replace(`./patientdetails.html?id=${id}`);
            });
          }
          // pemail
          // console.log(response1);

          // document.getElementById("loader1").style.visibility = "hidden";
        }
      });
    }

    function myfunc(x) {
      // x.location.href=this.href+'?id='+id;return false;
      // console.log(x.href)
      x.href = "notes.html?id=" + id;
      // console.log(x.href)
    }


    // const ctx = document.getElementById("myChart");

    // new Chart(ctx, {
    //   type: "line",
    //   data: {
    //     labels: [
    //       "1st",
    //       "2nd",
    //       "3rd",
    //       "4th",
    //       "5th",
    //       "6th",
    //       "7th",
    //       "8th",
    //       "9th",
    //       "10th",
    //       "11th",
    //       "12th",
    //       "13th",
    //       "14th",
    //       "15th",
    //     ],
    //     datasets: [{
    //       data: [
    //         40, 30, 90, 85, 112, 126, 140, 135, 120, 120, 120, 130, 130,
    //         150, 80,
    //       ],
    //       borderWidth: 4,
    //       borderColor: "#1577F2",
    //       fill: {
    //         target: "origin",
    //         above: "rgba(192, 228, 255, 0.12)", // Area will be red above the origin
    //       },
    //     }, ],
    //   },
    //   options: {
    //     responsive: true,
    //     maintainAspectRatio: false,
    //     plugins: {
    //       legend: {
    //         display: false,
    //       },
    //     },
    //     elements: {
    //       point: {
    //         radius: 0,
    //       },
    //     },
    //     scales: {
    //       y: {
    //         beginAtZero: true,
    //         grid: {
    //           display: false,
    //         },
    //         ticks: {
    //           font: {
    //             family: "Raleway", // Your font family
    //             size: 14,
    //           },
    //         },
    //       },
    //       x: {
    //         grid: {
    //           display: false,
    //         },
    //         ticks: {
    //           font: {
    //             family: "Raleway", // Your font family
    //             size: 14,
    //           },
    //         },
    //       },
    //     },
    //     plugins: {
    //       legend: {
    //         labels: {
    //           // This more specific font property overrides the global property
    //           font: {
    //             size: 16,
    //             family: "'Raleway'",
    //           },
    //         },
    //       },
    //     },
    //   },
    // });


    //  code for clock
    var weights = [];

    function myfuan(weightvalue, weights1) {
      weights1.push(weightvalue * 2.2046 / 1000);
      // console.log(weights.length)
      return weights1;
    }

    $("#blood-pressure-tab").click(function () {
      // console.log(token)
      // console.log(id)
      document.getElementById("loader1").style.visibility = "visible";
      var device_type = "Blood Pressure";
      var pid = id;
      $.ajax({
        type: "post",
        url: `${baseurl}/get-activation-token`,
        data: JSON.stringify({
          device_type: device_type,
          pid:pid
        }),
        timeout: 0,
        headers: {
          "Authorization": `Bearer ${token}`,
          "Content-Type": "application/json",
        },
        success: function (response1) {
          // console.log(response1)
          document.getElementById("loader1").style.visibility = "hidden";
          localStorage.setItem('with_access_token', response1.resa2.body.access_token);
          localStorage.setItem('with_refres_token', response1.resa2.body.refresh_token);
          populate_data_blood_pressure();
          // $("#div11").html(result);
          // console.log(response1);
          // pemail
          // console.log(response1);

          // document.getElementById("loader1").style.visibility = "hidden";
        }
      });
    });
    function populate_data_blood_pressure(){
      document.getElementById("loader1").style.visibility = "visible";
      var with_access_token = localStorage.getItem('with_access_token');
      if (with_access_token != undefined || with_access_token != null) {
        data = JSON.stringify({
          with_access_token: with_access_token,
          pid: id
        })
        var pressureslist = [];
        var humanReadableDate;
        var dateslist = [];
        $.ajax({
          type: "post",
          url: `${baseurl}/get-blood-pressure`,
          data: data,
          timeout: 0,
          headers: {
            "Authorization": `Bearer ${token}`,
            "Content-Type": "application/json",
          },
          success: function (response1) {

            // var ress = JSON.parse(response1);
            // console.log(response1.data)

            // response1.data.forEach(element => {
              
            // });
            // console.log(ress.body.measuregrps[0].measures[0].value)
            if(response1.msg == "reload"){
              populate_data_blood_pressure();
              return 0;
            }

            response1.data.forEach(key => {
              pressureslist.push(key.value);
              humanReadableDate = convertUnixTimestampToHumanReadable(key.dateofmeasurement);
              dateslist.push(humanReadableDate)
             });
            drawchart2(pressureslist, dateslist);
            document.getElementById("loader1").style.visibility = "hidden";
            
          }
        });


      }
      else{
        alert("No Token")
      }
    }

    function convertUnixTimestampToHumanReadable(unixTimestamp) {
  // Create a new Date object and set the timestamp
  const date = new Date(unixTimestamp * 1000); // Multiply by 1000 to convert from seconds to milliseconds

  // Get the individual components of the date
  const year = date.getFullYear();
  const month = ('0' + (date.getMonth() + 1)).slice(-2); // Months are zero-indexed, so we add 1
  const day = ('0' + date.getDate()).slice(-2);
  const hours = ('0' + date.getHours()).slice(-2);
  const minutes = ('0' + date.getMinutes()).slice(-2);
  const seconds = ('0' + date.getSeconds()).slice(-2);

  // Construct the human-readable date string
  const formattedDate = `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;

  return formattedDate;
}
    // function safe_basic_dta() {
    //   // console.log(token)
    //   var did = localStorage.getItem('id');
    //   var cid = document.getElementById("clientid").value;
    //   var csecret = document.getElementById("clientsecret").value;
    //   $.ajax({
    //     type: "post",
    //     url: `${baseurl}/add-cid-csecret/`,
    //     data: JSON.stringify({
    //         did:did,
    //         cid:cid,
    //         csecret:csecret,
    //     }),
    //     timeout: 0,
    //     headers: {
    //       "Authorization": `Bearer ${token}`,
    //       "Content-Type": "application/json",
    //     },
    //     success: function (response1) {

    //       // $("#div11").html(result);
    //       console.log(response1);
    //       // console.log(response1.nonce);
          
    //       if (response1.msg == "Data Added") {
    //         document.getElementById("loader1").style.visibility = "hidden";
    //         Swal.fire({
    //           icon: 'success',
    //           title: 'Successful!',
    //           text: response1.msg,
    //           allowOutsideClick: false
    //         })
    //         $('button.swal2-confirm').click(function () {
    //           window.location.reload();
    //         });
    //       }
    //       // pemail
    //       // console.log(response1);

    //       // document.getElementById("loader1").style.visibility = "hidden";
    //     }
    //   });
    // }


            // const ctx3 = document.getElementById("myChart3");
        // const weightchart = new Chart(ctx3, {
        //   type: "line",
        //   data: {
        //     labels: [

        //     ],
        //     datasets: [{
        //       label: "Weights",
        //       data: [

        //       ],
        //       borderWidth: 4,
        //       borderColor: "#B2EA47",
        //       fill: {
        //         target: "origin",
        //         above: "#D6FFDA1D", // Area will be red above the origin
        //       },
        //     }, ],
        //   },
        //   options: {
        //     responsive: true,
        //     maintainAspectRatio: false,
        //     plugins: {
        //       legend: {
        //         display: false,
        //       },
        //     },
        //     elements: {
        //       point: {
        //         radius: 3,
        //       },
        //     },
        //     scales: {
        //       y: {
        //         beginAtZero: true,
        //         grid: {
        //           display: false,
        //         },
        //         ticks: {
        //           font: {
        //             family: "Raleway", // Your font family
        //             size: 14,
        //           },
        //         },
        //       },
        //       x: {
        //         grid: {
        //           display: false,
        //         },
        //         ticks: {
        //           font: {
        //             family: "Raleway", // Your font family
        //             size: 14,
        //           },
        //         },
        //       },
        //     },
        //     plugins: {
        //       legend: {
        //         labels: {
        //           // This more specific font property overrides the global property
        //           font: {
        //             size: 16,
        //             family: "'Raleway'",
        //           },
        //         },
        //       },
        //     },
        //   },
        // });

        // function drawchart1(weights) {
        //   weights.sort(function (a, b) {
        //     return a - b
        //   })
        //   for (i = 0; i < weights.length; i++) {
        //     weightchart.data.labels.push(weights[i]);
        //     weightchart.data.datasets[0].data.push(weights[i]);
        //     // weightchart.data.datasets[0].labels.push(weights[i]);
        //   }
        //   weightchart.update();
        //   // console.log(weightchart.data.datasets[0].data);
        // }






    const ctx2 = document.getElementById("myChart2");


    const pressureschart = new Chart(ctx2, {
      type: "line",
      data: {
        labels: [

        ],
        datasets: [{
          label: "Blood Pressure",
          data: [
          ],
          borderWidth: 4,
          borderColor: "#B2EA47",
          fill: {
            target: "origin",
            above: "#D6FFDA1D", // Area will be red above the origin
          },
        }, ],
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            display: false,
          },
        },
        elements: {
          point: {
            radius: 0,
          },
        },
        scales: {
          y: {
            beginAtZero: true,
            grid: {
              display: false,
            },
            ticks: {
              font: {
                family: "Raleway", // Your font family
                size: 14,
              },
            },
          },
          x: {
            grid: {
              display: false,
            },
            ticks: {
              font: {
                family: "Raleway", // Your font family
                size: 14,
              },
            },
          },
        },
        plugins: {
          legend: {
            labels: {
              // This more specific font property overrides the global property
              font: {
                size: 16,
                family: "'Raleway'",
              },
            },
          },
        },
      },
    });

          function drawchart2(pressures, dates) {
            pressureschart.data.labels = [];
            pressureschart.data.datasets[0].data = [];
            pressureschart.update();
          for (i = 0; i < pressures.length; i++) {
            pressureschart.data.labels.push(dates[i]);
            pressureschart.data.datasets[0].data.push(pressures[i]);
          }
          pressureschart.update();
          // console.log(weightchart.data.datasets[0].data);
        }




  </script>
</body>

</html>