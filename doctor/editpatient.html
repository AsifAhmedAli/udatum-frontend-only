<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Edit Patient</title>
    <link rel="stylesheet" href="./assets/css/datatables.css" />
    <link rel="stylesheet" href="./assets/css/bootstrap.css" /><script src="env.js"></script>
  </head>
  <body>
    <aside>
      <div class="top">
        <a href="./index.html" class="d-block">
          <img src="./assets/images/logo-white.svg" height="48px" class="logo" alt="">
        </a>
        <ul class="list-unstyled ps-0 mb-0">
          <li class="side-link active">
            <a href="./dashboard.html">
              <span class="material-symbols material-symbols-rounded"
                >team_dashboard</span
              >
              Dashboard
            </a>
          </li>
          <li class="side-link">
            <a href="./registeredpatients.html">
              <span class="material-symbols material-symbols-rounded"
                >person</span
              >
              Patients
            </a>
          </li>
          <li class="side-link">
            <a href="#" id="messagesanchor">
              <span class="material-symbols material-symbols-rounded"
                >mail</span
              >
              Messages
              <!-- <div class="badge">New</div> -->
            </a>
          </li>
          <li class="side-link">
            <a href="./profile.html">
              <span class="material-symbols material-symbols-rounded"
                >settings</span
              >
              Settings
            </a>
          </li>
          <li class="side-link">
            <a href="./activate.html">
              <span class="material-symbols material-symbols-rounded"
                >shop</span
              >
              Activate Device
            </a>
          </li>
        </ul>
      </div>
      <div class="bottom">
        <div class="side-link">
          <a href="" id="logout-btn">
            <span class="material-symbols material-symbols-rounded"
              >logout</span
            >
            Logout
          </a>
        </div>
      </div>
    </aside>
    <main>
      <header>
        <div class="container">
          <div class="search-container">
            <a href="" class="logo">Udatum</a>
            <button type="button" class="search" id="search">
              <span class="material-symbols material-symbols-rounded"
                >search</span
              >
            </button>
            <form action="" class="w-100">
              <input
                type="search"
                class="form-control w-100"
                name=""
                id=""
                placeholder="Search"
              />
              <button class="btn btn-primary rounded-pill">
                <span class="material-symbols material-symbols-rounded"
                  >search</span
                >
              </button>
            </form>
          </div>
          <div class="right">
            <div class="dropdown">
              <button type="button" class="notifications unread" type="button" id="dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="false">
                <span class="material-symbols material-symbols-rounded"
                  >notifications</span
                >
              </button>
              <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
                <li><a class="dropdown-item" href="#">Action</a></li>
                <li><a class="dropdown-item" href="#">Another action</a></li>
                <li><a class="dropdown-item" href="#">Something else here</a></li>
              </ul>
            </div>
            
            <button type="button" class="avatar unread">JD</button>
            <button type="button" class="menu" id="menu">
              <span class="material-symbols material-symbols-rounded"
                >menu</span
              >
            </button>
          </div>
        </div>
      </header>
      <div class="container">
        <div class="top-bar">
          <button class="btn btn-primary btn-dashboard">
            <span class="material-symbols material-symbols-rounded">add</span>
            Edit Patient
          </button>
          <div class="date-time" id="clock">
            <span class="me-4"></span>
            <span></span>
          </div>
        </div>
      </div>
      <div class="content">
        <div class="patients-box">
          <h5 class="heading">Edit Patient Data</h5>
          <form id="edit_patient">
          <div class="row gx-3 gy-xl-5 gy-3 add-patient-table">
            <div class="col-md-6">
              <table class="w-100">
                <tr>
                  <td class="h5 text-center">
                    <span class="material-symbols material-symbols-rounded"
                      >person</span
                    >
                  </td>
                  <td>
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Patient Name"
                      id="pname"
                      required
                    />
                  </td>
                </tr>
              </table>
            </div>
            <div class="col-md-6">
              <table class="w-100">
                <tr>
                  <td class="h5 text-center">
                    <span class="material-symbols material-symbols-rounded"
                      >cake</span
                    >
                  </td>
                  <td>
                    <input
                      type="text"
                      onfocus="(this.type='date')"
                      onfocusout="(this.type='text')"
                      placeholder="Birthday"
                      class="form-control"
                      id="bdaydate1"
                      required
                    />
                  </td>
                </tr>
              </table>
            </div>
            <div class="col-md-6">
              <table class="w-100">
                <tr>
                  <td class="h5 text-center">
                    <span class="material-symbols material-symbols-rounded"
                      >email</span
                    >
                  </td>
                  <td>
                    <input
                      type="email"
                      class="form-control"
                      placeholder="Patient Email"
                      id="email1"
                      required
                    />
                  </td>
                </tr>
              </table>
            </div>
            <div class="col-md-6">
              <table class="w-100">
                <tr>
                  <td class="h5 text-center">
                    <span class="material-symbols material-symbols-rounded"
                      >analytics</span
                    >
                  </td>
                  <td>
                    <input
                      type="number"
                      class="form-control"
                      placeholder="High threshold (optional)"
                      required
                      id="high_threshold1"
                    />
                  </td>
                </tr>
              </table>
            </div>
            <div class="col-md-6">
              <table class="w-100">
                <tr>
                  <td class="h5 text-center">
                    <span class="material-symbols material-symbols-rounded"
                      >analytics</span
                    >
                  </td>
                  <td>
                    <input
                      type="number"
                      class="form-control"
                      placeholder="Low threshold (optional)"
                      value="1212"
                      id="Low_threshold1"
                      required
                    />
                  </td>
                </tr>
              </table>
            </div>
            <div class="col-12">
              <table class="w-100">
                <tr>
                  <td class="h5 text-center">
                    <span class="material-symbols material-symbols-rounded">
                      format_ink_highlighter
                    </span>
                  </td>
                  <td>
                    <textarea
                      cols="30"
                      rows="4"
                      class="form-control"
                      placeholder="Medical Condition"
                      id="medical_condition1"
                      required
                    ></textarea>
                  </td>
                </tr>
              </table>
            </div>
            <!-- <div class="col-12">
              <table class="w-100">
                <tr>
                  <td class="h5 text-center">
                    <span class="material-symbols material-symbols-rounded">
                      format_ink_highlighter
                    </span>
                  </td>
                  <td>
                    <textarea
                      cols="30"
                      rows="4"
                      class="form-control"
                      placeholder="Notes"
                      id="notes1"
                    >asdfasdfasdfasdf</textarea>
                  </td>
                </tr>
              </table>
            </div> -->
            <div class="col-12 text-center">
              <button
                class="btn btn-primary btn-lg px-xl-4"
                type="submit"
              >
                <span class="material-symbols material-symbols-rounded"
                  >check</span
                >
                Save
              </button>
            </div>
          </div>
        </form>
        </div>
      </div>
    </main>

    <script src="./assets/js/all.js"></script>
    <script src="./assets/js/script.js"></script>
    <script src="./assets/js/datatables.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="./assets/js/logout.js"></script>
    <div class="loading" id="loader1" style="visibility: hidden;">Loading&#8230;</div>
    <script>
      //  code for clock

$(document).ready(function() {
  if ($(window).width() < 768) {
          $("#search").click(function () {
            $(this).next().slideToggle();
          });
        }

        if ($(window).width() < 1100) {
          $("#menu").click(function () {
            $("aside").toggleClass("d-flex");
          });
        }
  var table = $("#example").DataTable({
          dom: "Bfrtip",
          lengthMenu: [8, 32, 50, 75, 100],
        });

  urlString = window.location.href;
      let paramString = urlString.split('?')[1];
      let queryString = new URLSearchParams(paramString);
      for(let pair of queryString.entries()) {
        id = pair[1];
          // console.log("Key is:" + pair[0]);
          // console.log("Value is:" + pair[1]);
      }
  var token = localStorage.getItem('token');
  var user_ida = localStorage.getItem('id');
var messagesanchor = document.getElementById("messagesanchor");
  messagesanchor.setAttribute("href", `${clientbaseurl}/doctor/chat.html?id=${user_ida}`);
      // console.log(token)
      if(token == null){
        window.location.replace("login.html");
      }
      else{
        $.ajax({
              type: "get",
              url: `${baseurl}/patient-list-of-a-doctor`,
              timeout: 0,
              headers: {
                "Authorization": `Bearer ${token}`,
                "Content-Type": "application/json",
              },
              success: function (response) {
                  // $("#div11").html(result);
                  console.log("success");
                  // document.getElementById("loader1").style.visibility = "hidden";
              },
              error: function(response) {
                // console.log(response);
                
                if(response.responseJSON.message == "Authentication failed"){
                  window.location.replace("login.html");
                    }
              }
          });
      }
      document.getElementById("loader1").style.visibility = "visible";
      $.ajax({
              type: "get",
              url: `${baseurl}/get-one-patient/${id}`,
              timeout: 0,
              headers: {
                "Authorization": `Bearer ${token}`,
                "Content-Type": "application/json",
              },
              success: function (response) {
                  // $("#div11").html(result);
                  console.log(response);
                  document.getElementById("pname").value = response.name;
                  // document.getElementById("bdaydate1").value = response.date_of_birth;
                  document.getElementById("email1").value = response.email;
                  document.getElementById("high_threshold1").value = response.high_threshold;
                  document.getElementById("Low_threshold1").value = response.low_threshold;
                  document.getElementById("medical_condition1").value = response.medical_condition;
                  
                  document.getElementById("loader1").style.visibility = "hidden";
              },
              error: function(response) {
                // console.log(response);
                
                if(response.responseJSON.message == "Authentication failed"){
                  window.location.replace("login.html");
                    }
              }
          });


  // Update clock display every second
  setInterval(function() {
    var now = new Date();
    
    // Format date and time
    var date = now.toLocaleDateString('en-US', {day: 'numeric', month: 'long', year: 'numeric'});
    var hours = now.getHours();
    var minutes = now.getMinutes();
    var seconds = now.getSeconds();
    var ampm = hours >= 12 ? 'PM' : 'AM';
    hours = hours % 12;
    hours = hours ? hours : 12;
    minutes = minutes < 10 ? '0' + minutes : minutes;
    seconds = seconds < 10 ? '0' + seconds : seconds;
    var time = hours + ':' + minutes + ':' + seconds + ' ' + ampm;
    
    // Display date and time in clock element
    $('#clock').text(date + ' ' + time);
  }, 1000);


var request;
  $("#edit_patient").submit(function (event) {

// Prevent default posting of form - put here to work in case of errors
event.preventDefault();

// Abort any pending request
if (request) {
    request.abort();
}
  // var token = localStorage.getItem('token');
  var name = document.getElementById("pname").value;
  var bdaydate1 = document.getElementById("bdaydate1").value;
  var email1 = document.getElementById("email1").value;
  // var ppass = document.getElementById("ppass").value;
  // var barcode = document.getElementById("barcode").value;
  var high_threshold1 = document.getElementById("high_threshold1").value;

  var Low_threshold1 = document.getElementById("Low_threshold1").value;
  var medical_condition1 = document.getElementById("medical_condition1").value;
  // var notes1 = document.getElementById("notes1").value;
  // console.log(token);
//   var settings = {
//   "url": `${baseurl}/patient-registration`,
//   "method": "POST",
//   "timeout": 0,
//   "headers": {
//     "Authorization": `Bearer ${token}`,
//     "Content-Type": "application/json",
//   },
//   "data": JSON.stringify({
//     "name": name,
//     "date_of_birth": bdaydate1,
//     "email": email1,
//     "password": ppass,
//     "medical_condition": medical_condition1,
//     "low_threshold": Low_threshold1,
//     "high_threshold": high_threshold1,
//     "device_barcode": barcode,
//     "notes": notes1
//   }),
// };
data = JSON.stringify({
    "name": name,
    "date_of_birth": bdaydate1,
    "email": email1,
    // "password": ppass,
    "medical_condition": medical_condition1,
    "low_threshold": Low_threshold1,
    "high_threshold": high_threshold1,
    // "device_barcode": barcode,
    // "notes": notes1
  });
  // console.log(data);
document.getElementById("loader1").style.visibility = "visible";
          $.ajax({
              type: "put",
              data: data,
              url: `${baseurl}/patient-edit/${id}`,
              timeout: 0,
              headers: {
                "Authorization": `Bearer ${token}`,
                "Content-Type": "application/json",
              },
              success: function (response) {
                  // $("#div11").html(result);
                  // console.log(result)
                  Swal.fire({
                    icon: 'success',
                    title: 'Successful!',
                    text: response.message,
                    allowOutsideClick: false
                  })
                  $( 'button.swal2-confirm' ).click(function() {
                    window.location.reload();
                  });
                  document.getElementById("loader1").style.visibility = "hidden";
              },
              error: function(response) {
                // console.log(response);
                
                if(response.responseJSON.message == "Authentication failed"){
                  window.location.replace("login.html");
                    }
                if(response.status == 500){
                      Swal.fire({
                      title: "Error!",
                      text: response.responseJSON.message1,
                      icon: "error"
                    });          
                    }
              }
          });
// $.ajax(settings).done(function (response) {
  // document.getElementById("loader1").style.visibility = "hidden";
  // console.log(response);
// });
  });
});

    </script>
  </body>
</html>
