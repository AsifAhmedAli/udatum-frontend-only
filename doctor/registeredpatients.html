<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Registered Patients</title>
    <link rel="stylesheet" href="./assets/css/datatables.css" />
    <link rel="stylesheet" href="./assets/css/bootstrap.css" /><script src="env.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  </head>
  <body>
    <aside>
      <div class="top">
        <a href="./index.html" class="d-block">
          <img src="./assets/images/logo-white.svg" height="48px" class="logo" alt="">
        </a>
        <ul class="list-unstyled ps-0 mb-0">
          <li class="side-link active">
            <a href="./dashboard.html">
              <span class="material-symbols material-symbols-rounded"
                >team_dashboard</span
              >
              Dashboard
            </a>
          </li>
          <li class="side-link">
            <a href="./registeredpatients.html">
              <span class="material-symbols material-symbols-rounded"
                >person</span
              >
              Patients
            </a>
          </li>
          <li class="side-link">
            <a href="#" id="messagesanchor">
              <span class="material-symbols material-symbols-rounded"
                >mail</span
              >
              Messages
              <!-- <div class="badge">New</div> -->
            </a>
          </li>
          <li class="side-link">
            <a href="./profile.html">
              <span class="material-symbols material-symbols-rounded"
                >settings</span
              >
              Settings
            </a>
          </li>
          <li class="side-link">
            <a href="./activate.html">
              <span class="material-symbols material-symbols-rounded"
                >shop</span
              >
              Activate Device
            </a>
          </li>
        </ul>
      </div>
      <div class="bottom">
        <div class="side-link">
          <a href="" id="logout-btn">
            <span class="material-symbols material-symbols-rounded"
              >logout</span
            >
            Logout
          </a>
        </div>
      </div>
    </aside>
    <main>
      <header>
        <div class="container">
          <div class="search-container">
            <a href="" class="logo">Udatum</a>
            <button type="button" class="search" id="search">
              <span class="material-symbols material-symbols-rounded"
                >search</span
              >
            </button>
            <form action="" class="w-100">
              <input
                type="search"
                class="form-control w-100"
                name=""
                id=""
                placeholder="Search"
              />
              <button class="btn btn-primary rounded-pill">
                <span class="material-symbols material-symbols-rounded"
                  >search</span
                >
              </button>
            </form>
          </div>
          <div class="right">
            <div class="dropdown">
              <button type="button" class="notifications unread" type="button" id="dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="false">
                <span class="material-symbols material-symbols-rounded"
                  >notifications</span
                >
              </button>
              <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
                <li><a class="dropdown-item" href="#">Action</a></li>
                <li><a class="dropdown-item" href="#">Another action</a></li>
                <li><a class="dropdown-item" href="#">Something else here</a></li>
              </ul>
            </div>
            
            <button type="button" class="avatar unread" id="user-initials"></button>
            <button type="button" class="menu" id="menu">
              <span class="material-symbols material-symbols-rounded"
                >menu</span
              >
            </button>
          </div>
        </div>
      </header>
      <div class="container">
        <div class="top-bar">
          <a href="./addpatient.html" class="btn btn-primary btn-dashboard">
            <span class="material-symbols material-symbols-rounded">add</span>
            Add New Patient
          </a>
          <div class="date-time" id="clock">
            <span class="me-4"></span>
            <span></span>
          </div>
        </div>
      </div>
      <div class="content">
        <div class="patients-box">
          <h5 class="heading">Registered Patients</h5>
          <div class="register-search-filter">
            <div class="left mb-3">
              <input
                type="text"
                class="form-control form-control-lg"
                placeholder="Search By Name"
              />
              <button class="px-xl-5 rounded btn btn-primary py-2">
                <span class="material-symbols material-symbols-rounded"
                  >search</span
                >
              </button>
            </div>
            <div class="dropdown mb-3">
              <button
                class="btn btn-outline-secondary py-2 dropdown-toggle rounded"
                type="button"
                id="dropdownMenuButton1"
                data-bs-toggle="dropdown"
                aria-expanded="false"
              >
                Filter By
              </button>
              <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
                <li><a class="dropdown-item" href="#">Action</a></li>
                <li><a class="dropdown-item" href="#">Another action</a></li>
                <li>
                  <a class="dropdown-item" href="#">Something else here</a>
                </li>
              </ul>
            </div>
          </div>
          <div class="table-responsive">
            <table
              class="table table-borderless table-custom clickable"
              id="example"
            >
              <thead>
                <tr>
                  <th scope="col"></th>
                  <th scope="col">Patient Name</th>
                  <th scope="col">Patient Email</th>
                  <th scope="col" class="text-center">Birthdate</th>
                  <th scope="col" class="text-center">Actions</th>
                </tr>
              </thead>
              <tbody id="all_patients">


              </tbody>
            </table>
          </div>
        </div>
      </div>
    </main>

    
    <!-- Modal -->
    <div
      class="modal fade custom-modal"
      id="viewDetails"
      tabindex="-1"
      aria-labelledby="viewDetailsLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-xl">
        <div class="modal-content">
          <div class="modal-header position-absolute w-100 border-0">
            <h5 class="modal-title" id="viewDetailsLabel"></h5>
            <button
              class="btn btn-light text-danger bg-transparent btn-lg"
              data-bs-dismiss="modal"
              aria-label="Close"
            >
              <span class="material-symbols material-symbols-rounded top-0"
                >cancel</span
              >
            </button>
          </div>
          <div class="modal-body">
            <div class="header">
              <div class="info gap-xl-4 gap-3">
                <h6 class="heading">Sign Up Date</h6>
                <p class="mb-0">12/12/2022</p>
              </div>
              <h4 class="title">Patient Details</h4>
            </div>
            <div class="container-fluid">
              <div class="row g-3 pt-5">
                <div class="col-lg-4 col-12">
                  <div class="info gap-xl-4 gap-3">
                    <h6 class="heading">Patient Name</h6>
                    <p class="mb-0">Haseeb Khan</p>
                  </div>
                </div>
                <div class="col-lg-4 col-12">
                  <div class="info justify-content-lg-center gap-xl-4 gap-3">
                    <h6 class="heading">Patient Email</h6>
                    <p class="mb-0">Haseebkhan@gmail.com</p>
                  </div>
                </div>
                <div class="col-lg-4 col-12">
                  <div class="info justify-content-lg-end gap-xl-4 gap-3">
                    <h6 class="heading">Birthdate</h6>
                    <p class="mb-0">12-12-1996</p>
                  </div>
                </div>
              </div>
            </div>
            <table class="table table-borderless info d-table mt-5">
              <tbody>
                <tr>
                  <td style="width: 144px"><h6>Medical Condition</h6></td>
                  <td>
                    <textarea
                      name=""
                      id=""
                      cols="30"
                      rows="3"
                      class="form-control w-100"
                    ></textarea>
                  </td>
                </tr>
                <tr>
                  <td style="width: 144px"><h6>Notes</h6></td>
                  <td>
                    <textarea
                      name=""
                      id=""
                      cols="30"
                      rows="3"
                      class="form-control w-100"
                    ></textarea>
                  </td>
                </tr>
              </tbody>
            </table>
            <div class="text-center mt-xl-5 mt-3">
              <a href="" class="btn btn-primary btn-lg px-xl-4 mx-3">
                <span class="material-symbols material-symbols-rounded"
                  >check</span
                >
                Update
              </a>
              <button class="btn btn-outline-primary btn-lg px-xl-4 mx-3">
                <span class="material-symbols material-symbols-rounded"
                  >share</span
                >
                Share Data
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="loading" id="loader1" style="visibility: hidden;">Loading&#8230;</div>
    <script src="./assets/js/all.js"></script>
    <script src="./assets/js/script.js"></script>
    <script src="./assets/js/datatables.js"></script>
    <script src="./assets/js/logout.js"></script>
    <script>
      
      // function editpatient(x){

      // }
      $(document).ready(function () {
        var user_ida = localStorage.getItem('id');
var messagesanchor = document.getElementById("messagesanchor");
  messagesanchor.setAttribute("href", `${clientbaseurl}/doctor/chat.html?id=${user_ida}`);
        // var messagesanchor = document.getElementById("messagesanchor");
        // messagesanchor.setAttribute("href", `${baseurl}/chat.html/${user_ida}`);

        function getMonthName(monthNumber) {
          const date = new Date();
          date.setMonth(monthNumber - 1);
          return date.toLocaleString('en-US', { month: 'long' });
        }
        var token = localStorage.getItem('token');
      // console.log(token)
      if(token == null){
        window.location.replace("login.html");
      }
      else{
        document.getElementById("loader1").style.visibility = "visible";
        $.ajax({
              type: "get",
              url: `${baseurl}/patient-list-of-a-doctor`,
              timeout: 0,
              headers: {
                "Authorization": `Bearer ${token}`,
                "Content-Type": "application/json",
              },
              success: function (response) {
                // console.log(response)
                response.patients.forEach(key => {
                  var dateFormat= new Date(key.date_of_birth);
                  document.getElementById("all_patients").innerHTML += 
                  `<tr>
                  <td>
                    <a href="./patientdetails.html?id=${key.id}"></a>
                  </td>
                  <td>${key.name}</td>
                  <td>${key.email}</td>
                  <td class="text-center">${dateFormat.getDate()+"/"+(getMonthName(dateFormat.getMonth()+1))+"/"+dateFormat.getFullYear()}</td>
                  <td class="text-center">
                    <a href="./editpatient.html?id=${key.id}" class="table-patient-action">
                      <span
                        class="material-symbols material-symbols-rounded only-icon"
                        >edit</span
                      >
                    </a>
                    <a type="button" onclick="delfunc('${key.id}', '${token}')" class="table-patient-action">
                      <span
                        class="material-symbols material-symbols-rounded only-icon"
                        >delete</span
                      >
                    </a>
                  </td>
                </tr>`; 
                });

                  // $("#div11").html(result);
                  // console.log(response);

                  document.getElementById("loader1").style.visibility = "hidden";
              },
              error: function(response) {
                // console.log(response);
                
                if(response.responseJSON.message == "Authentication failed"){
                  window.location.replace("login.html");
                    }
              }
          });
      }

        if ($(window).width() < 768) {
          $("#search").click(function () {
            $(this).next().slideToggle();
          });
        }

        if ($(window).width() < 1100) {
          $("#menu").click(function () {
            $("aside").toggleClass("d-flex");
          });
        }
      });
    </script>
    <script>
      $(document).ready(function () {
// Attach click event handler to logout button
        var table = $("#example").DataTable({
          dom: "Bfrtip",
          lengthMenu: [8, 32, 50, 75, 100],
        });
      });
    </script>
    <script>
  

  //     const token = localStorage.getItem('token');
  //     const decodedToken = JSON.parse(atob(token.split('.')[1]));
  //     const userId = decodedToken.id;
  //     console.log(userId)

  // if(userId && token) {
  //   $(document).ready(function() {
			

	// 		$.ajax({
	// 			url: 'http://localhost:3000/patient-list-of-a-doctor',
	// 			type: 'GET',
	// 			headers: { 'Authorization': 'Bearer ' + token },
	// 			data: { userId: userId }
	// 		}).done(function(response) {
	// 			var table = $('#example').DataTable({
	// 				data: response,
	// 				columns: [
	// 					{ data: 'name' },
	// 					{ data: 'email' },
	// 					{ data: 'phone' },
	// 					{ data: 'gender' },
	// 					{ data: 'age' },
	// 					{
	// 						data: null,
	// 						render: function(data, type, row) {
	// 							return '<button onclick="viewPatientDetails(' + row.id + ')">View Details</button>';
	// 						}
	// 					}
	// 				]
	// 			});

	// 			$('#example').on('page.dt', function() {
	// 				$('html, body').animate({
	// 					scrollTop: $("#example").offset().top
	// 				}, 500);
	// 			});
	// 		}).fail(function(jqXHR, textStatus) {
	// 			alert('Error: ' + textStatus);
	// 		});
	// 	});

	// 	function viewPatientDetails(patientId) {
	// 		// Code to view patient details
	// 	}
  
  // }  


//       $(document).ready(function() {
//     // Populate table with patient data using DataTable
//     var table = $('#patientsTable').DataTable({
//         "processing": true,
//         "serverSide": true,
//         "ajax": {
//             "url": "/api/patients",
//             "headers": { "Authorization": "Bearer " + localStorage.getItem("token") },
//             "type": "GET"
//         },
//         "columns": [
//             { "data": "id" },
//             { "data": "first_name" },
//             { "data": "last_name" },
//             { "data": "email" },
//             { "data": "phone" },
//             { "data": "gender" },
//             { "data": "birthday" },
//             { "data": "actions", "orderable": false, "searchable": false }
//         ],
//         "columnDefs": [
//             { "className": "dt-center", "targets": "_all" }
//         ],
//         "order": [[0, 'desc']],
//         "dom": 'Bfrtip',
//         "buttons": [
//             { extend: 'copy', className: 'btn btn-secondary' },
//             { extend: 'csv', className: 'btn btn-secondary' },
//             { extend: 'excel', className: 'btn btn-secondary' },
//             { extend: 'pdf', className: 'btn btn-secondary' },
//             { extend: 'print', className: 'btn btn-secondary' },
//         ],
//         "initComplete": function(settings, json) {
//             $(".loader").hide();
//             $("#patientsTable").show();
//         }
//     });

//     // Handle limit change
//     $("#limit").change(function() {
//         table.page.len($(this).val()).draw();
//     });
// });

      // $(document).ready(function() {
      //   $('#example').DataTable({
      //     "processing": true,
      //     "serverSide": true,
      //     "ajax": {
      //       "url": "http://localhost:3000/patient-list-of-a-doctor",
      //       "type": "GET",
      //       "dataType": "json",
      //       "dataSrc": "data",
      //       "beforeSend": function(request) {
      //         request.setRequestHeader("Authorization", "Bearer " + localStorage.getItem("token"));
      //       }
      //     },
      //     "columns": [
      //       { "data": "name" },
      //       { "data": "email" },
      //       { "data": "phone" },
      //       { "data": "gender" },
      //       { "data": "dob" },
      //       { "data": "address" }
      //     ],
      //     "dom": 'Bfrtip',
      //         "buttons": [
      //             { extend: 'copy', className: 'btn btn-primary' },
      //             { extend: 'csv', className: 'btn btn-primary' },
      //             { extend: 'excel', className: 'btn btn-primary' },
      //             { extend: 'pdf', className: 'btn btn-primary' },
      //             { extend: 'print', className: 'btn btn-primary' }
      //         ],
      //         "lengthMenu": [ [10, 25, 50, -1], [10, 25, 50, "All"] ]
      //   });
      // });
    </script>

    <script>
      $(".open-chat").click(function () {
        $(".bubble-chat").addClass("d-flex");
      });

      $(".close-chat").click(function () {
        $(".bubble-chat").removeClass("d-flex");
      });
    </script>

    <script>
      function auto_grow(element) {
        element.style.height = "5px";
        element.style.height = element.scrollHeight + "px";
      }
    </script>
    <script>
      objDiv = document.getElementById("chat-box");
      objDiv.scrollTop = objDiv.scrollHeight;
    </script>
    <script>
      //  code for clock

$(document).ready(function() {

  // Update clock display every second
  setInterval(function() {
    var now = new Date();
    
    // Format date and time
    var date = now.toLocaleDateString('en-US', {day: 'numeric', month: 'long', year: 'numeric'});
    var hours = now.getHours();
    var minutes = now.getMinutes();
    var seconds = now.getSeconds();
    var ampm = hours >= 12 ? 'PM' : 'AM';
    hours = hours % 12;
    hours = hours ? hours : 12;
    minutes = minutes < 10 ? '0' + minutes : minutes;
    seconds = seconds < 10 ? '0' + seconds : seconds;
    var time = hours + ':' + minutes + ':' + seconds + ' ' + ampm;
    
    // Display date and time in clock element
    $('#clock').text(date + ' ' + time);
  }, 1000);
});

// code for logged-in user initials
function delfunc(id, token) {
          // alert(id);
      document.getElementById("loader1").style.visibility = "visible";
      $.ajax({
              type: "delete",
              url: `${baseurl}/patient-delete/${id}`,
              timeout: 0,
              headers: {
                "Authorization": `Bearer ${token}`,
                "Content-Type": "application/json",
              },
              success: function (response) {
                // console.log(response);s
                Swal.fire({
                  icon: 'success',
                  title: 'Successful!',
                  text: response.message,
                  allowOutsideClick: false
                })
                $('button.swal2-confirm').click(function () {
                  location.reload();
                });
                  // timeonscreen = parseInt(response.results[0].time_spent);
                  document.getElementById("loader1").style.visibility = "hidden";
              }
          });
        }
$(document).ready(function() {

  // Check if user is logged in and display name initials
  var token = localStorage.getItem('token');
// Extract the user's name from the token
var name = JSON.parse(atob(token.split('.')[1])).name;

// Display the first two letters of the name in the designated element
var initials = name.substr(0, 2).toUpperCase();
$('#user-initials').text(initials);
});
    </script>
    <script>


    </script>
  </body>
</html>
